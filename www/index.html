<!DOCTYPE html>
<html>
    <head>
        <title>pyAggr3g470r</title>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="width=device-width, user-scalable=no,
            initial-scale=1, maximum-scale=1, minimum-scale=1" />
        <!--Import materialize.css-->
        <link type="text/css" rel="stylesheet"
            href="bower_components/Materialize/dist/css/materialize.min.css"
            media="screen,projection"/>
        <link type="text/css" rel="stylesheet"
            href="css/main.css"
            media="screen,projection"/>
        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="user-scalable=no, initial-scale=1,
            maximum-scale=1, minimum-scale=1, width=device-width">
        <script>
            if (window.hyper) { console.log = hyper.log; }
        </script>
    </head>
    <body>
        <div class="navbar-fixed">
            <nav>
                <div class="nav-wrapper blue-grey">
                    <a href="#" data-activates="slide-out" class="button-collapse"><i class="mdi-navigation-menu"></i></a>
                    <a href="#!" class="brand-logo">pyAggr3g470r</a>
                    <ul class="side-nav fixed" id="slide-out">
                        <li class="logo">
                            <a id="logo-container" href="index.html" class="brand-logo">
                                <img src="images/icon-menu.png" />
                            </a>
                        </li>
                        <li class="bold"><a href="index.html"></a></li>
                        <div id="navbar-anchors"></div>
                        <li class="bold"><hr /></li>
                        <li class="bold"><a href="signin.html" class="waves-effect waves-teal">Use a different account</a></li>
                        <li class="bold"><a href="#modalAbout" class="waves-effect waves-teal modal-trigger">About this application</a></li>
                    </ul>
                </div>
            </nav>
        </div>

        <div class="app">
            <div class="row">
                <div class="col s12 m12">
                    <div class="card blue-grey darken-1">
                        <div class="card-content white-text">
                            <span class="card-title">Articles</span>
                        </div>
                        <ul class="tabs">
                            <li class="tab col s4"><a href="#list-all-articles">All</a></li>
                            <li class="tab col s4"><a href="#list-read-articles">Read</a></li>
                            <li class="tab col s4"><a class="active" href="#list-unread-articles">Unread</a></li>
                        </ul>
                        <ul id="list-all-articles" class="collapsible" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header center">
                                    <div class="preloader-wrapper small active">
                                        <div class="spinner-layer spinner-blue-only">
                                            <div class="circle-clipper right">
                                                <div class="circle"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                        <ul id="list-read-articles" class="collapsible" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header center">
                                    <div class="preloader-wrapper small active">
                                        <div class="spinner-layer spinner-blue-only">
                                            <div class="circle-clipper right">
                                                <div class="circle"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                        <ul id="list-unread-articles" class="collapsible" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header center">
                                    <div class="preloader-wrapper small active">
                                        <div class="spinner-layer spinner-blue-only">
                                            <div class="circle-clipper right">
                                                <div class="circle"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="app">
            <div class="row">
                <div class="col s12 m12">
                    <div class="card blue-grey darken-1">
                        <div class="card-content white-text">
                            <span class="card-title">Your favorite articles</span>
                        </div>
                        <ul id="list-favorites-articles" class="collapsible" data-collapsible="accordion"></ul>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="bower_components/lodash/lodash.min.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
        <script type="text/javascript" src="bower_components/Materialize/dist/js/materialize.min.js"></script>
        <script>
            $("#close-application").click(function(){
                window.localStorage.removeItem("password");
                navigator.app.exitApp();
            });
        </script>
        <script>
        function load_all_articles(all_articles) {
            all_articles = _.map(all_articles, function(e){
                e.hour = app.date_to_hour(e.date); return e; });
            all_articles = _.sortBy(all_articles, 'hour').reverse();
            var allArticlesTmpl = _.template(
                '<li>' +
                    '<div class="collapsible-header truncate">' +
                        '<%= title %>' +
                    '</div>' +
                    '<div class="collapsible-body">' +
                        '<p class="flow-text"><b><%= content %></p>' +
                    '</div>' +
                '</li>');
            for (article in all_articles) {
                $('#list-all-articles').append(allArticlesTmpl(
                    {
                        title: all_articles[article].title,
                        content: all_articles[article].content
                    }
                ));
            }
            $('.collapsible').collapsible({
                accordion : false
            });
        }

        function load_read_articles(read_articles) {
            read_articles = _.map(read_articles, function(e){
                e.hour = app.date_to_hour(e.date); return e; });
            read_articles = _.sortBy(read_articles, 'hour').reverse();
            var readArticlesTmpl = _.template(
                '<li>' +
                    '<div class="collapsible-header truncate">' +
                        '<%= title %>' +
                    '</div>' +
                    '<div class="collapsible-body">' +
                        '<p class="flow-text"><b><%= content %></p>' +
                    '</div>' +
                '</li>');
            for (article in read_articles) {
                $('#list-read-articles').append(readArticlesTmpl(
                    {
                        title: read_articles[article].title,
                        content: read_articles[article].content
                    }
                ));
            }
            $('.collapsible').collapsible({
                accordion : false
            });
        }

        function load_unread_articles(unread_articles) {
            unread_articles = _.map(unread_articles, function(e){
                e.hour = app.date_to_hour(e.date); return e; });
            unread_articles = _.sortBy(unread_articles, 'hour').reverse();
            var unreadArticlesTmpl = _.template(
                '<li>' +
                    '<div class="collapsible-header truncate">' +
                        '<%= title %>' +
                    '</div>' +
                    '<div class="collapsible-body">' +
                        '<p class="flow-text"><b><%= content %></p>' +
                    '</div>' +
                '</li>');
            for (article in unread_articles) {
                $('#list-unread-articles').append(unreadArticlesTmpl(
                    {
                        title: unread_articles[article].title,
                        content: unread_articles[article].content
                    }
                ));
            }
            $('.collapsible').collapsible({
                accordion : false
            });
        }

            function load_favorites_articles(favorites_articles) {
                favorites_articles = _.map(favorites_articles, function(e){
                    e.hour = app.date_to_hour(e.date); return e; });
                favorites_articles = _.sortBy(favorites_articles, 'hour').reverse();
                var favoritesArticlesTmpl = _.template(
                    '<li>' +
                        '<div class="collapsible-header truncate">' +
                            '<%= title %>' +
                        '</div>' +
                        '<div class="collapsible-body">' +
                            '<p class="flow-text"><b><%= content %></p>' +
                        '</div>' +
                    '</li>');
                for (article in favorites_articles) {
                    $('#list-favorites-articles').append(favoritesArticlesTmpl(
                        {
                            title: favorites_articles[article].title,
                            content: favorites_articles[article].content
                        }
                    ));
                }
                $('.collapsible').collapsible({
                    accordion : false
                });
            }

            $( document ).ready(function() {
                // Initialize collapse button
                $('.button-collapse').sideNav({
                    menuWidth: 300, // Default is 240
                    edge: 'left', // Choose the horizontal origin
                    closeOnClick: true // Closes side-nav on <a> clicks, useful for Angular/Meteor
                });

                // are we running in native app or in a browser?
                // are we running in native app or in a browser?
                window.isphone = false;
                if (typeof cordova !== 'undefined') {
                    window.isphone = true;
                }

                // load the different cards
                app.load("articles?limit=10", load_all_articles, "list-all-articles", {});
                app.load("articles?readed=True&limit=10", load_read_articles, "list-read-articles", {});
                app.load("articles?readed=False&limit=50", load_unread_articles, "list-unread-articles", {});

                app.load("articles?like=True&limit=10", load_favorites_articles, "list-favorites-articles", {});

                $('.collapsible').collapsible({
                    accordion : false
                });
            });
        </script>
    </body>
</html>
